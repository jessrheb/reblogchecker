const t="nhEAeubCSI57GS2pbE5CzllVrXQ9IRzKwU4wDn2EkWZFqnsk1T",r="https://api.tumblr.com/v2/blog/",o={origin:{retrieveBlogBasics:"Sorry, I was unable to get any blog credentials:",retrieveBlogPosts:"Sorry, I was unable to get your blog posts:",extractPostCredentials:"Sorry, I was unable to find this post's ID:",retrievePostRootID:"Sorry, I was unable to find this post's original ID:",blognameValidation:"Whoops! Unexpected format or spelling:"},error:{notFound:{blogname:"I couldn't get any information from the blogname you provided. If you're pretty sure it's spelled correctly, then make sure it's not hidden from people without an account too.",postURL:"I couldn't get any information from the URL you provided."},limitExceeded:"Looks like we made too many requests to Tumblr in a short span of time.",notOK:"Something weird happened, either on our own end or yours.",noPostId:"Make sure you entered a valid post URL (E.g.: https://www.tumblr.com/blogname/123456789101112 or https://blogname.tumblr.com/post/123456789101112).",noRootId:"Is the original poster's blog not hidden from people without an account and the post ID correct?",unexpectedError:"Please check if you entered a valid blogname/URL in the appropriate field."},ending:{generic:"Try again a little later!",specific:"Please either choose another blog to search or try again a little later."}},n="https://www.tumblr.com/",i="www.tumblr.com/",s="tumblr.com/",a=".tumblr.com/",l=".tumblr.com";function c(t){return!!(t.startsWith(n)||t.startsWith(i)||t.startsWith(s))||!(t.endsWith(a)||t.endsWith(l)||t.includes("/post/"))&&void 0}function d(t){return c(t)?t.trim().replace(n,"").replace(i,"").replace(s,""):c(t)?void 0:t.trim().replace("https://","").replace(a," ").replace(l," ")}function u(t){function r(t){return/[.\/:]/g.test(t)?void 0:t}if(c(t)){let o=d(t);return r(o)}if(!c(t)){let o=d(t).trim();return r(o)}return r(t)}function p(t,r){return t.slice(-t.length,t.indexOf(r))}const h={getBlogname:()=>JSON.parse(sessionStorage.getItem("CheckingFor")),postRootID:""};async function g(n){try{let i=function(t){if(u(t))return u(t);throw Error(`${o.origin.blognameValidation} ${o.error.unexpectedError}`)}(n),s=await fetch(`${r}${i}.tumblr.com/info?api_key=${t}`);if(404===s.status)throw Error(`${o.origin.retrieveBlogBasics} ${o.error.notFound.blogname}`);if(429===s.status)throw Error(`${o.origin.retrieveBlogBasics} ${o.error.limitExceeded} ${o.ending.generic}`);if(!s.ok)throw Error(`${o.origin.retrieveBlogBasics} ${o.error.notOK} ${o.ending.generic}`);let a=await s.json(),l=a.response.blog.uuid,c=a.response.blog.total_posts;return[i,l,c]}catch(t){throw t}}async function m([n,i,s]){try{let a=[];for(let o=0;o<=s;o+=50)a.push(await fetch(`${r}${i}/posts?api_key=${t}&limit=50&offset=${o}&reblog_info=true`));let l=a.map(t=>t.status);if(l.includes(404))throw Error(`${o.origin.retrieveBlogPosts} ${o.error.notFound.blogname} ${o.ending.specific}`);if(l.includes(429))throw Error(`${o.origin.retrieveBlogPosts} ${o.error.limitExceeded} ${o.ending.specific}`);if(!l.every(t=>200===t))throw Error(`${o.origin.retrieveBlogPosts} ${o.error.notOK} ${o.ending.specific}`);let c=await Promise.all(a.map(async t=>await t.json())),d=c.flatMap(t=>t.response.posts.map(t=>({rootID:t.reblogged_root_id??t.id_string,postURL:t.post_url})));if(!function(t){let r;try{r=window[t];let o="__storage_test__";return r.setItem(o,o),r.removeItem(o),!0}catch(t){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&r&&0!==r.length}}("sessionStorage"))throw Error("Sorry! Seems like you don't have enough space in your session storage or it isn't altogether available in the browser you're using. Reblog Checker needs access to it in order to work.");sessionStorage.setItem("CheckingFor",JSON.stringify(`${n}`)),sessionStorage.setItem(`${n}PostsInfo`,JSON.stringify(d)),console.log(`${n}'s posts root IDs and reblogs URLs retrieved and stored in ${n}PostsInfo!`)}catch(t){throw t}}async function f(t){try{/* NEW URL FORMAT */if(c(t)){let r=d(t).replace("/"," ").split(" "),[n,i]=r;/* INVALID POST URL ERROR TAKES PRECEDENCE OVER BLOG UUID NOT FOUND */if(!i)throw Error(`${o.origin.extractPostCredentials} ${o.error.notFound.postURL} ${o.error.noPostId}`);let[,s]=await g(n);if(!s)return;if(i.includes("/")){let t=p(i,"/");return[n,s,t]}if(i.includes("?")){let t=p(i,"?");return[n,s,t]}return[n,s,i]}/* OLD URL FORMAT */if(!c(t)){let r=d(t).replace("post/","").split(" "),[n,i]=r;/* INVALID POST URL ERROR TAKES PRECEDENCE OVER BLOG UUID NOT FOUND */if(!i)throw Error(`${o.origin.extractPostCredentials} ${o.error.notFound.postURL} ${o.error.noPostId}`);let[,s]=await g(n);if(!s)return;if(i.includes("/")){let t=p(i,"/");return[n,s,t]}if(i.includes("?")){let t=p(i,"?");return[n,s,t]}return[n,s,i]}return}catch(t){throw t}}async function S([,n,i]){try{let s=await fetch(`${r}${n}/posts?api_key=${t}&id=${i}&reblog_info=true`);if(404===s.status)throw Error(`${o.origin.retrievePostRootID} ${o.error.notFound.postURL} ${o.error.noRootId}`);if(429===s.status)throw Error(`${o.origin.retrievePostRootID} ${o.error.limitExceeded} ${o.ending.generic}`);if(!s.ok)throw Error(`${o.origin.retrievePostRootID} ${o.error.notOK} ${o.ending.generic}`);let a=await s.json(),l=a.response.posts.at(0).reblogged_root_id??a.response.posts.at(0).id_string;return l}catch(t){throw t}}class w{inputSet=[".input","input"];errorMessage='.message[data-type="error"]';mainScreen=document.querySelector("main");stepHeading=document.querySelector(".step-heading");iconHeading=document.querySelector(".icon-heading");checkingForWindow=document.querySelector(".checking-for");buttonTag=document.querySelector(".button-tag");addHandlerScreenReset(t=this.activeScreen){t.querySelector("input").addEventListener("input",this.resetScreen.bind(this))}stepScreenInit(t=this.activeStep){[this.mainScreen,this.stepHeading,this.checkingForWindow].forEach(r=>r.setAttribute("data-state",t))}loadStopAnimation(){let t=this.stepHeading.getAnimations({subtree:!0}).find(t=>"loadingSpinner"===t.animationName);t.pause();let r=getComputedStyle(this.stepHeading).transform,o=this.stepHeading.animate([{transform:r},{transform:"matrix(1, 0, 0, 1, 0, 0)"}],{duration:300,fill:"forwards"});return o.finished}renderSpinner(){this.stepHeading.setAttribute("data-state","loading-spinner")}inputValidation(t,r=this.activeScreen){this.inputSet.forEach(o=>r.querySelector(o).setAttribute("data-valid",t)),t||r.querySelector("button").setAttribute("disabled",!0)}renderError(t,r){let o=t.querySelector(this.errorMessage);o.setAttribute("data-active",!0),o.querySelector("p").innerText=`${r.message}`}errorManager(t,r=this.activeScreen){this.loadStopAnimation().then(()=>{this.renderError(r,t),this.stepScreenInit(),this.inputValidation(!1)})}resetForm(){"button"!==this.stepForm[1].localName?this.stepForm.forEach(t=>t.reset()):this.stepForm.reset()}resetScreen(t=!0){let r=["data-active","data-valid","disabled"];t||r.shift(),r.forEach(t=>this.mainScreen.querySelectorAll(`[${t}]`).forEach(r=>r.removeAttribute(t)))}}class b extends w{activeStep="step-one";activeScreen=document.querySelector("#step-one");stepForm=document.querySelector(".blogname-form");constructor(){super(),this.addHandlerScreenReset()}addHandlerBlognameForm(t){this.stepForm.addEventListener("submit",r=>{r.preventDefault();let o=new FormData(r.target),n=Object.fromEntries(o).blognameForm;t(n)})}}var y=new b;class v extends w{activeStep="step-two";activeScreen=document.querySelector("#step-two");stepForm=document.querySelector(".post-form");constructor(){super(),this.addHandlerScreenReset()}addHandlerPostForm(t){this.stepForm.addEventListener("submit",r=>{this.resetScreen(),r.preventDefault();let o=new FormData(r.target),n=Object.fromEntries(o).postForm;t(n)})}setCheckingForBlogname(t){this.buttonTag.innerText=t}}var E=new v;class $ extends w{stepForm=document.querySelectorAll("form");scrollIntoView=document.querySelector("header button");constructor(){super(),this.addHandlerScrollIntoView()}addHandlerScrollIntoView(){this.scrollIntoView.addEventListener("click",()=>this.mainScreen.scrollIntoView({behavior:"smooth"}))}addHandlerSessionWatch(t){window.addEventListener("load",t)}addHandlerStepWatch(t){let r=new MutationObserver(t);r.observe(this.mainScreen,{attributeFilter:["data-state"],attributeOldValue:!0})}addHandlerStoreScroll(t){document.addEventListener("scroll",t,{passive:!0})}addHandlerStepBackward(t){this.buttonTag.addEventListener("click",t)}stepWatch(t){let r=["bi-1-circle","bi-2-circle"];t.forEach(t=>{t.target.dataset.state!==t.oldValue&&r.forEach(t=>this.iconHeading.classList.toggle(t))})}debounce(t){let r;return(...o)=>{r&&cancelAnimationFrame(r),r=requestAnimationFrame(()=>{t(...o)})}}storeScroll(){let t=[this.stepHeading,this.checkingForWindow];document.documentElement.dataset.scroll=window.scrollY,window.scrollY>=window.innerHeight-window.innerHeight/3?t.forEach(t=>t.setAttribute("data-visible",!0)):t.forEach(t=>t.setAttribute("data-visible",!1))}}var I=new $;class R extends w{outputWindow=document.querySelectorAll(".output");numberOfInstances=document.querySelector(".instances");postURLs=document.querySelector(".post-urls");setReblogInstances(t){this.numberOfInstances.innerText=t>1?`${t} times`:`${t} time`}setURLAttributes(t,r){Object.keys(r).forEach(o=>{t.setAttribute(o,r[o])})}setReblogURLs(t){t.forEach(t=>{let r=document.createElement("a");r.innerText=t,this.setURLAttributes(r,{href:t,target:"_blank",rel:"noopener noreferrer"}),this.postURLs.appendChild(r)})}resetReblogURLs(){this.postURLs.hasChildNodes()&&this.postURLs.querySelectorAll("a").forEach(t=>this.postURLs.removeChild(t))}showResult(t){this.outputWindow.forEach(r=>r.dataset.result===t&&r.setAttribute("data-active",!0))}}var F=new R;async function k(t){try{I.renderSpinner();let r=await g(t);y.inputValidation(!0),await m(r),I.loadStopAnimation().then(()=>{y.resetScreen(!1),E.stepScreenInit(),E.setCheckingForBlogname(h.getBlogname())})}catch(t){console.error(t),y.errorManager(t)}}async function L(t){try{I.renderSpinner();let r=await f(t),o=await S(r);E.inputValidation(!0),h.postRootID=o,I.loadStopAnimation().then(()=>{E.resetScreen(!1),E.stepScreenInit(),function(){let t=function(t,r){let o=JSON.parse(sessionStorage.getItem(`${t}PostsInfo`));if(!o)return;let n=o.filter(t=>t.rootID===r),i=n.length;if(i){let t=n.map(t=>t.postURL);return[i,t]}}(h.getBlogname(),h.postRootID);if(!t){F.showResult("negative");return}let[r,o]=t;F.setReblogInstances(r),F.resetReblogURLs(),F.setReblogURLs(o),F.showResult("positive")}()})}catch(t){console.error(t),E.errorManager(t)}}I.addHandlerSessionWatch(function(){sessionStorage.getItem("CheckingFor")?(E.stepScreenInit(),E.setCheckingForBlogname(h.getBlogname())):y.stepScreenInit()}),I.addHandlerStepWatch(function(t){I.stepWatch(t)}),I.addHandlerStoreScroll(function(){I.debounce(I.storeScroll),I.storeScroll()}),I.addHandlerStepBackward(function(){window.confirm(`Done checking for ${h.getBlogname()}? This will take you back to the previous step.`)&&(sessionStorage.clear(),I.resetForm(),I.resetScreen(),y.stepScreenInit())}),y.addHandlerBlognameForm(k),E.addHandlerPostForm(L);//# sourceMappingURL=index.5ee3ca99.js.map

//# sourceMappingURL=index.5ee3ca99.js.map
